<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safebut? - Pregnancy Safety Checker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§∞Safebut?</h1>
            <p class="subtitle">Check the safety of anything during pregnancy</p>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="search">üîç Search</button>
                <button class="tab-btn" data-tab="profile">üë§ Profile</button>
                <button class="tab-btn" data-tab="history">üìú History</button>
                <button class="tab-btn logout-btn" id="logoutBtn" onclick="logout()">üö™ Logout</button>
            </div>
        </header>

        <main>
            <!-- Search Tab Content -->
            <div id="searchTab" class="tab-content active">
                <div class="search-section">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Enter anything to check if it's safe (e.g., 'coffee', 'flying', 'yoga', 'hot tubs')"
                        autocomplete="off"
                    >
                    <button id="cameraBtn" type="button" class="camera-btn" title="Take a photo">
                        üì∑
                    </button>
                    <button id="searchBtn" type="button">
                        <span class="btn-text">Check Safety</span>
                        <span class="loader" style="display: none;"></span>
                    </button>
                </div>
                
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                
                <div id="imagePreview" class="image-preview" style="display: none;">
                    <img id="capturedImage" alt="Captured image">
                    <button id="removeImage" class="remove-image">‚úï</button>
                </div>
                <div class="example-chips">
                    <span class="chip" data-example="coffee">Coffee</span>
                    <span class="chip" data-example="sushi">Sushi</span>
                    <span class="chip" data-example="flying">Flying</span>
                    <span class="chip" data-example="yoga">Yoga</span>
                    <span class="chip" data-example="hot tubs">Hot Tubs</span>
                    <span class="chip" data-example="hair dye">Hair Dye</span>
                </div>
            </div>

            <div id="results" class="results-section" style="display: none;">
                <div class="result-card">
                    <div class="result-header">
                        <h2 id="itemName"></h2>
                        <span id="safetyBadge" class="safety-badge"></span>
                    </div>
                    
                    <div id="safetyVerdict" class="safety-verdict"></div>
                    
                    <div class="risk-scale">
                        <h3>Risk Level Assessment</h3>
                        <div class="risk-meter">
                            <div id="riskIndicator" class="risk-indicator">5</div>
                        </div>
                        <div class="risk-labels">
                            <span>1 (Safest)</span>
                            <span>5 (Moderate)</span>
                            <span>10 (Most Risky)</span>
                        </div>
                    </div>
                    
                    <div id="resultContent" class="result-content"></div>
                    
                    <div id="referencesSection" class="references-section">
                        <h3>üìö Learn More</h3>
                        <div id="referenceLinks"></div>
                    </div>
                    
                    <div class="disclaimer">
                        <strong>‚ö†Ô∏è Important:</strong> This information is AI-generated and should not replace professional medical advice. Always consult your healthcare provider before making any decisions during pregnancy.
                    </div>
                </div>
            </div>

                <div id="error" class="error-message" style="display: none;">
                    <span class="error-icon">‚ö†Ô∏è</span>
                    <span id="errorText"></span>
                </div>
            </div>
            
            <!-- Profile Tab Content -->
            <div id="profileTab" class="tab-content" style="display: none;">
                <div class="profile-section">
                    <h2>Your Health Profile</h2>
                    <p class="profile-intro">Fill in your information for personalized safety recommendations:</p>
                    
                    <!-- Basic Profile Information -->
                    <div class="basic-info">
                        <h3>üë§ Basic Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="profile-name">Name</label>
                                <input type="text" id="profile-name" placeholder="Your name">
                            </div>
                            
                            <div class="form-group">
                                <label for="profile-age">Age</label>
                                <input type="number" id="profile-age" placeholder="Your age" min="16" max="60">
                            </div>
                            
                            <div class="form-group">
                                <label for="due-date">Due Date</label>
                                <input type="date" id="due-date">
                            </div>
                            
                            <div class="form-group">
                                <label for="weeks-pregnant">Weeks Pregnant</label>
                                <input type="number" id="weeks-pregnant" placeholder="Current week" min="1" max="42">
                            </div>
                            
                            <div class="form-group">
                                <label for="pregnancy-number">Pregnancy Number</label>
                                <select id="pregnancy-number">
                                    <option value="">Select...</option>
                                    <option value="1">First pregnancy</option>
                                    <option value="2">Second pregnancy</option>
                                    <option value="3">Third pregnancy</option>
                                    <option value="4+">Fourth or more</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="healthcare-provider">Healthcare Provider</label>
                                <input type="text" id="healthcare-provider" placeholder="Doctor/Midwife name">
                            </div>
                        </div>
                    </div>
                    
                    <div class="health-conditions">
                        <h3>ü©∫ Medical Conditions</h3>
                        <div class="condition-grid">
                            <label class="condition-toggle">
                                <input type="checkbox" id="gestational-diabetes" name="conditions">
                                <span class="toggle-label">Gestational Diabetes</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="preeclampsia" name="conditions">
                                <span class="toggle-label">Preeclampsia / High Blood Pressure</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="anemia" name="conditions">
                                <span class="toggle-label">Anemia</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="thyroid" name="conditions">
                                <span class="toggle-label">Thyroid Disorders</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="placenta-previa" name="conditions">
                                <span class="toggle-label">Placenta Previa</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="hyperemesis" name="conditions">
                                <span class="toggle-label">Hyperemesis Gravidarum</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="rh-negative" name="conditions">
                                <span class="toggle-label">Rh Negative Blood Type</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="multiples" name="conditions">
                                <span class="toggle-label">Multiple Pregnancy (Twins/Triplets)</span>
                            </label>
                        </div>
                        
                        <h3>‚ö†Ô∏è Risk Factors</h3>
                        <div class="condition-grid">
                            <label class="condition-toggle">
                                <input type="checkbox" id="high-risk" name="risk-factors">
                                <span class="toggle-label">High-Risk Pregnancy</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="over-35" name="risk-factors">
                                <span class="toggle-label">Age 35 or Older</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="previous-miscarriage" name="risk-factors">
                                <span class="toggle-label">Previous Miscarriage</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="ivf" name="risk-factors">
                                <span class="toggle-label">IVF Pregnancy</span>
                            </label>
                        </div>
                        
                        <h3>üçΩÔ∏è Dietary Restrictions</h3>
                        <div class="condition-grid">
                            <label class="condition-toggle">
                                <input type="checkbox" id="vegetarian" name="diet">
                                <span class="toggle-label">Vegetarian</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="vegan" name="diet">
                                <span class="toggle-label">Vegan</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="gluten-free" name="diet">
                                <span class="toggle-label">Gluten-Free</span>
                            </label>
                            
                            <label class="condition-toggle">
                                <input type="checkbox" id="lactose-intolerant" name="diet">
                                <span class="toggle-label">Lactose Intolerant</span>
                            </label>
                        </div>
                        
                        <h3>üìÖ Pregnancy Stage</h3>
                        <div class="trimester-selector">
                            <label class="radio-option">
                                <input type="radio" name="trimester" value="first" id="first-trimester">
                                <span class="radio-label">First Trimester (Weeks 1-12)</span>
                            </label>
                            
                            <label class="radio-option">
                                <input type="radio" name="trimester" value="second" id="second-trimester">
                                <span class="radio-label">Second Trimester (Weeks 13-27)</span>
                            </label>
                            
                            <label class="radio-option">
                                <input type="radio" name="trimester" value="third" id="third-trimester">
                                <span class="radio-label">Third Trimester (Weeks 28-40)</span>
                            </label>
                        </div>
                    </div>
                    
                    <button id="saveProfile" class="save-profile-btn">üíæ Save Profile</button>
                    
                    <div class="profile-note">
                        <p>üîí Your health information is stored locally and only used to personalize your safety recommendations.</p>
                    </div>
                </div>
            </div>
            
            <!-- History Tab Content -->
            <div id="historyTab" class="tab-content" style="display: none;">
                <div class="history-section">
                    <div class="history-header">
                        <h3>Search History</h3>
                        <button id="clearHistory" class="clear-history">Clear All</button>
                    </div>
                    <div id="historyItems" class="history-items"></div>
                </div>
            </div>

        </main>

        <footer>
            <p>This tool provides general information only. Always consult your healthcare provider for personalized medical advice.</p>
        </footer>
    </div>

    <script>
        // Logout function
        function logout() {
            // Clear local storage
            localStorage.removeItem('authToken');
            localStorage.removeItem('isPremium');
            localStorage.removeItem('userEmail');
            
            // Clear session on server
            fetch('/auth/logout', {
                method: 'POST',
                credentials: 'include'
            }).then(() => {
                // Redirect to login page
                window.location.href = '/login';
            }).catch(() => {
                // Even if server logout fails, still redirect
                window.location.href = '/login';
            });
        }
        
        // Check if user is authenticated before loading app
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const trial = urlParams.get('trial');
            
            // Store token if provided in URL
            if (token) {
                localStorage.setItem('authToken', token);
            }
            
            // Check if we have a token or are in trial mode
            const storedToken = localStorage.getItem('authToken');
            
            if (!storedToken && !trial) {
                // No token and not trial, redirect to login
                window.location.href = '/login';
                return;
            }
            
            // Load the main app script after DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    const script = document.createElement('script');
                    script.src = 'app.js';
                    document.body.appendChild(script);
                });
            } else {
                // DOM already loaded
                const script = document.createElement('script');
                script.src = 'app.js';
                document.body.appendChild(script);
            }
        })();
    </script>
</body>
</html>